import { Disposable } from 'vs/base/common/lifecycle';
import { TPromise, PPromise } from 'vs/base/common/winjs.base';
import URI from 'vs/base/common/uri';
import Event from 'vs/base/common/event';
import { ISearchService, ISearchProgressItem, ISearchComplete, ISearchQuery, IPatternInfo, IFileMatch } from 'vs/platform/search/common/search';
import { ReplacePattern } from 'vs/platform/search/common/replace';
import { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';
import { Range } from 'vs/editor/common/core/range';
import { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';
import { IModelService } from 'vs/editor/common/services/modelService';
import { IReplaceService } from 'vs/workbench/parts/search/common/replace';
import { IProgressRunner } from 'vs/platform/progress/common/progress';
import { RangeHighlightDecorations } from 'vs/workbench/common/editor/rangeDecorations';
export declare class Match {
    private _parent;
    private _lineText;
    private _id;
    private _range;
    constructor(_parent: FileMatch, text: string, lineNumber: number, offset: number, length: number);
    id(): string;
    parent(): FileMatch;
    text(): string;
    range(): Range;
    preview(): {
        before: string;
        inside: string;
        after: string;
    };
    readonly replaceString: string;
    getMatchString(): string;
}
export declare class FileMatch extends Disposable {
    private _query;
    private _maxResults;
    private _parent;
    private rawMatch;
    private modelService;
    private replaceService;
    private static _CURRENT_FIND_MATCH;
    private static _FIND_MATCH;
    private static getDecorationOption(selected);
    private _onChange;
    onChange: Event<boolean>;
    private _onDispose;
    onDispose: Event<void>;
    private _resource;
    private _model;
    private _modelListener;
    private _matches;
    private _removedMatches;
    private _selectedMatch;
    private _updateScheduler;
    private _modelDecorations;
    constructor(_query: IPatternInfo, _maxResults: number, _parent: FolderMatch, rawMatch: IFileMatch, modelService: IModelService, replaceService: IReplaceService);
    private createMatches();
    private registerListeners();
    private bindModel(model);
    private onModelWillDispose();
    private unbindModel();
    private updateMatchesForModel();
    private updatesMatchesForLineAfterReplace(lineNumber, modelChange);
    private updateMatches(matches, modelChange);
    updateHighlights(): void;
    id(): string;
    parent(): FolderMatch;
    matches(): Match[];
    remove(match: Match): void;
    replace(toReplace: Match): TPromise<void>;
    setSelectedMatch(match: Match): void;
    getSelectedMatch(): Match;
    isMatchSelected(match: Match): boolean;
    count(): number;
    resource(): URI;
    name(): string;
    add(match: Match, trigger?: boolean): void;
    private removeMatch(match);
    dispose(): void;
}
export interface IChangeEvent {
    elements: FileMatch[];
    added?: boolean;
    removed?: boolean;
}
export declare class FolderMatch extends Disposable {
    private _resource;
    private _id;
    private _index;
    private _query;
    private _parent;
    private _searchModel;
    private replaceService;
    private telemetryService;
    private instantiationService;
    private _onChange;
    onChange: Event<IChangeEvent>;
    private _onDispose;
    onDispose: Event<void>;
    private _fileMatches;
    private _unDisposedFileMatches;
    private _replacingAll;
    constructor(_resource: URI, _id: string, _index: number, _query: ISearchQuery, _parent: SearchResult, _searchModel: SearchModel, replaceService: IReplaceService, telemetryService: ITelemetryService, instantiationService: IInstantiationService);
    readonly searchModel: SearchModel;
    readonly showHighlights: boolean;
    replacingAll: boolean;
    id(): string;
    resource(): URI;
    index(): number;
    name(): string;
    parent(): SearchResult;
    hasRoot(): boolean;
    add(raw: IFileMatch[], silent: boolean): void;
    clear(): void;
    remove(match: FileMatch): void;
    replace(match: FileMatch): TPromise<any>;
    matches(): FileMatch[];
    isEmpty(): boolean;
    fileCount(): number;
    count(): number;
    private onFileChange(fileMatch);
    private doAdd(fileMatch);
    private doRemove(fileMatch, dispose?, trigger?);
    private disposeMatches();
    dispose(): void;
}
export declare class SearchResult extends Disposable {
    private _searchModel;
    private replaceService;
    private telemetryService;
    private instantiationService;
    private _onChange;
    onChange: Event<IChangeEvent>;
    private _folderMatches;
    private _folderMatchesMap;
    private _query;
    private _showHighlights;
    private _rangeHighlightDecorations;
    constructor(_searchModel: SearchModel, replaceService: IReplaceService, telemetryService: ITelemetryService, instantiationService: IInstantiationService);
    query: ISearchQuery;
    readonly searchModel: SearchModel;
    add(allRaw: IFileMatch[], silent?: boolean): void;
    clear(): void;
    remove(match: FileMatch | FolderMatch): void;
    replace(match: FileMatch): TPromise<any>;
    replaceAll(progressRunner: IProgressRunner): TPromise<any>;
    folderMatches(): FolderMatch[];
    matches(): FileMatch[];
    isEmpty(): boolean;
    fileCount(): number;
    folderCount(): number;
    count(): number;
    readonly showHighlights: boolean;
    toggleHighlights(value: boolean): void;
    readonly rangeHighlightDecorations: RangeHighlightDecorations;
    private getFolderMatch(resource);
    private readonly otherFiles;
    private replacingAll;
    private disposeMatches();
    dispose(): void;
}
export declare class SearchModel extends Disposable {
    private searchService;
    private telemetryService;
    private instantiationService;
    private _searchResult;
    private _searchQuery;
    private _replaceActive;
    private _replaceString;
    private _replacePattern;
    private _onReplaceTermChanged;
    onReplaceTermChanged: Event<void>;
    private currentRequest;
    constructor(searchService: ISearchService, telemetryService: ITelemetryService, instantiationService: IInstantiationService);
    isReplaceActive(): boolean;
    replaceActive: boolean;
    readonly replacePattern: ReplacePattern;
    replaceString: string;
    readonly searchResult: SearchResult;
    search(query: ISearchQuery): PPromise<ISearchComplete, ISearchProgressItem>;
    private onSearchCompleted(completed, duration);
    private onSearchError(e, duration);
    private onSearchProgress(p);
    cancelSearch(): boolean;
    dispose(): void;
}
export declare type FileMatchOrMatch = FileMatch | Match;
export declare type RenderableMatch = FolderMatch | FileMatch | Match;
export declare class SearchWorkbenchService implements ISearchWorkbenchService {
    private instantiationService;
    _serviceBrand: any;
    private _searchModel;
    constructor(instantiationService: IInstantiationService);
    readonly searchModel: SearchModel;
}
export declare const ISearchWorkbenchService: {
    (...args: any[]): void;
    type: ISearchWorkbenchService;
};
export interface ISearchWorkbenchService {
    _serviceBrand: any;
    readonly searchModel: SearchModel;
}
